<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro - Dashboard de Gerenciamento de Risco</title>

  <style>
    :root{--bg:#ffffff;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:rgba(15, 23, 42, .10);
      --shadow:0 10px 25px rgba(15, 23, 42, .08);
      --radius:16px;
      --accent:#2563eb;
      --ok:#16a34a;
      --bad:#dc2626;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:var(--text);
      padding:22px;
      min-height:100vh;
    }
    a{color:var(--accent); text-decoration:none; font-weight:700}
    .wrap{max-width:1000px; margin:0 auto;}

    .panel{
      background:#ffffff;
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:#ffffff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .panelBody{padding:16px}

    .subtitle{color:var(--muted); font-size:13px}

    .grid{display:grid; grid-template-columns:repeat(2, minmax(160px, 1fr)); gap:10px;}
    .row{margin-bottom:10px;}

    label{font-size:12px; color:var(--muted); display:block; margin:0 0 6px 0}
    select,input,button{
      width:100%;
      background:#ffffff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    option{color:#0f172a}
    button{cursor:pointer; font-weight:900}
    button:hover{filter:brightness(1.08)}

    .danger{border-color:rgba(239,68,68,.55)}
    .success{border-color:rgba(34,197,94,.55)}

    .msg{margin-top:10px; font-size:13px}
    .msg.ok{color:var(--ok)}
    .msg.bad{color:var(--bad)}

    .help{margin-top:12px; padding:12px; border-radius:14px; border:1px solid var(--line); background:rgba(255,255,255,.02)}

    @media (max-width: 720px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:14px;">
      <div>
        <div style="display:flex; align-items:center; gap:12px;">
          <a href="index.html">‚¨Ö Voltar</a>
          <h1 style="margin:0; font-size:22px;">üìù Cadastro</h1>
        </div>
        <div class="subtitle">Cadastrar e salvar no Firebase (Firestore)</div>
      </div>
      <div class="subtitle" id="stamp"></div>
    </header>

    <div class="panel">
      <div class="panelHead">
        <div>
          <div style="font-weight:900">Escolha o tipo</div>
          <div class="subtitle">Os dados v√£o para cole√ß√µes separadas no Firestore</div>
        </div>
        <div class="subtitle" id="statusConn">‚óè pronto</div>
      </div>

      <div class="panelBody">
        <div class="row">
          <label for="tipo">Tipo de cadastro</label>
          <select id="tipo">
            <option value="sinistros">üö® Sinistros</option>
            <option value="seguros">üì¶ Seguro de carga</option>
            <option value="custo_gr">üí∞ Custo GR</option>
          </select>
        </div>

        <div id="formArea"></div>

        <div class="grid" style="margin-top:6px">
          <button id="btnSalvar">Salvar no Firebase</button>
          <button id="btnLimpar" type="button">Limpar</button>
        </div>

        <div id="msg" class="msg"></div>

        <div class="help subtitle">
          <div style="font-weight:900; margin-bottom:6px; color:var(--text)">Observa√ß√µes importantes</div>
          <ul style="margin:0; padding-left:18px">
            <li>Abra o dashboard via <b>Firebase Hosting</b> ou um <b>servidor local</b> (file:// pode bloquear m√≥dulos ES).</li>
            <li>Se aparecer erro de permiss√£o, ajuste as <b>Rules</b> do Firestore.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD27g5d1fChDpR8e2EVBmYPnOr9HVMZEf0",
      authDomain: "dashboard-gr-adm.firebaseapp.com",
      projectId: "dashboard-gr-adm",
      storageBucket: "dashboard-gr-adm.firebasestorage.app",
      messagingSenderId: "509008344044",
      appId: "1:509008344044:web:0148273507946420a206c9",
      measurementId: "G-NEEJ2C6SB8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tipo = document.getElementById("tipo");
    const formArea = document.getElementById("formArea");
    const msg = document.getElementById("msg");

    document.getElementById('stamp').textContent =
      'Atualizado: ' + new Date().toLocaleString('pt-BR');

    function htmlSinistros(){
      return `
        <div class="grid">
          <div class="row">
            <label>Data</label>
            <input id="s_data" type="date" />
          </div>
          <div class="row">
            <label>Empresa</label>
            <input id="s_empresa" placeholder="LIBFARMA" />
          </div>
        </div>
        <div class="grid">
          <div class="row">
            <label>Tipo</label>
            <input id="s_tipo" placeholder="Roubo / Colis√£o / Avaria..." />
          </div>
          <div class="row">
            <label>Status</label>
            <input id="s_status" placeholder="Aberto / Em an√°lise / Fechado" />
          </div>
        </div>
        <div class="row">
          <label>Preju√≠zo (R$)</label>
          <input id="s_prejuizo" type="number" step="0.01" placeholder="35000" />
        </div>
      `;
    }

    function htmlSeguros(){
      return `
        <div class="grid">
          <div class="row">
            <label>Ano</label>
            <input id="g_ano" type="number" placeholder="2025" />
          </div>
          <div class="row">
            <label>Seguradora</label>
            <input id="g_seguradora" placeholder="Porto Seguro" />
          </div>
        </div>
        <div class="grid">
          <div class="row">
            <label>Vencimento (m√™s)</label>
            <input id="g_venc" placeholder="Jan" />
          </div>
          <div class="row">
            <label>Valor segurado (R$)</label>
            <input id="g_valor" type="number" step="0.01" placeholder="500000" />
          </div>
        </div>
      `;
    }

    function htmlCustoGR(){
      return `
        <div class="grid">
          <div class="row">
            <label>Ano</label>
            <input id="c_ano" type="number" placeholder="2025" />
          </div>
          <div class="row">
            <label>Empresa</label>
            <input id="c_empresa" placeholder="LIBFARMA" />
          </div>
        </div>
        <div class="grid">
          <div class="row">
            <label>M√™s</label>
            <input id="c_mes" placeholder="Jan" />
          </div>
          <div class="row">
            <label>Pago (GR) (R$)</label>
            <input id="c_pago" type="number" step="0.01" placeholder="21271.36" />
          </div>
        </div>
        <div class="row">
          <label>Saldo (GR) (R$)</label>
          <input id="c_saldo" type="number" step="0.01" placeholder="12762.81" />
        </div>
      `;
    }

    function renderForm(){
      msg.textContent = '';
      msg.className = 'msg';

      if (tipo.value === 'sinistros') formArea.innerHTML = htmlSinistros();
      if (tipo.value === 'seguros') formArea.innerHTML = htmlSeguros();
      if (tipo.value === 'custo_gr') formArea.innerHTML = htmlCustoGR();
    }

    function clearForm(){
      const inputs = formArea.querySelectorAll('input');
      inputs.forEach(i => i.value = '');
      msg.textContent = '';
      msg.className = 'msg';
    }

    tipo.addEventListener('change', renderForm);
    document.getElementById('btnLimpar').addEventListener('click', clearForm);

    document.getElementById('btnSalvar').addEventListener('click', async () => {
      msg.textContent = '';
      msg.className = 'msg';

      try{
        let payload = {};

        if (tipo.value === 'sinistros'){
          payload = {
            data: document.getElementById('s_data').value,
            empresa: (document.getElementById('s_empresa').value || '').trim(),
            tipo: (document.getElementById('s_tipo').value || '').trim(),
            status: (document.getElementById('s_status').value || '').trim(),
            prejuizo: Number(document.getElementById('s_prejuizo').value || 0),
            createdAt: serverTimestamp()
          };
        }

        if (tipo.value === 'seguros'){
          payload = {
            ano: Number(document.getElementById('g_ano').value || 0),
            seguradora: (document.getElementById('g_seguradora').value || '').trim(),
            vencimento: (document.getElementById('g_venc').value || '').trim(),
            valor: Number(document.getElementById('g_valor').value || 0),
            createdAt: serverTimestamp()
          };
        }

        if (tipo.value === 'custo_gr'){
          payload = {
            ano: Number(document.getElementById('c_ano').value || 0),
            empresa: (document.getElementById('c_empresa').value || '').trim(),
            mes: (document.getElementById('c_mes').value || '').trim(),
            pago: Number(document.getElementById('c_pago').value || 0),
            saldo: Number(document.getElementById('c_saldo').value || 0),
            createdAt: serverTimestamp()
          };
        }

        await addDoc(collection(db, tipo.value), payload);

        msg.textContent = '‚úÖ Salvo com sucesso no Firebase!';
        msg.classList.add('ok');
        clearForm();
      }catch(e){
        console.error(e);
        msg.textContent = '‚ùå Erro ao salvar. Veja o console (F12).';
        msg.classList.add('bad');
      }
    });

    renderForm();
  </script>
</body>
</html>
